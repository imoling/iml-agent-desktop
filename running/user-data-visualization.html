<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户数据分析可视化</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .description {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.5;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        .chart-card {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .chart-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.12);
        }
        .chart-title {
            font-size: 20px;
            font-weight: 600;
            color: #3498db;
            margin-bottom: 20px;
            text-align: center;
        }
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        .data-summary {
            background-color: #fff;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 40px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
        }
        .summary-title {
            font-size: 22px;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .stat-item {
            text-align: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #3498db;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #95a5a6;
            font-size: 14px;
        }
        @media (max-width: 768px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
            .chart-card {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>用户数据分析可视化</h1>
            <p class="description">基于 user-data.csv 数据的交互式可视化分析，包含年龄分布、性别比例和分组统计</p>
        </header>

        <div class="data-summary">
            <h2 class="summary-title">数据概览</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value">20</div>
                    <div class="stat-label">总记录数</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">32.0</div>
                    <div class="stat-label">平均年龄</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">12-57</div>
                    <div class="stat-label">年龄范围</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">60%</div>
                    <div class="stat-label">男性比例</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">40%</div>
                    <div class="stat-label">女性比例</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">29.5</div>
                    <div class="stat-label">中位数年龄</div>
                </div>
            </div>
        </div>

        <div class="charts-container">
            <div class="chart-card">
                <h3 class="chart-title">年龄分布直方图</h3>
                <div class="chart-wrapper">
                    <canvas id="ageHistogram"></canvas>
                </div>
                <p style="text-align: center; margin-top: 15px; color: #666; font-size: 14px;">
                    显示用户年龄的分布情况，大部分用户集中在20-35岁之间
                </p>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">性别比例饼图</h3>
                <div class="chart-wrapper">
                    <canvas id="genderPieChart"></canvas>
                </div>
                <p style="text-align: center; margin-top: 15px; color: #666; font-size: 14px;">
                    男性用户占60%，女性用户占40%，性别比例为3:2
                </p>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">按性别分组的年龄分布</h3>
                <div class="chart-wrapper">
                    <canvas id="ageByGenderChart"></canvas>
                </div>
                <p style="text-align: center; margin-top: 15px; color: #666; font-size: 14px;">
                    女性平均年龄(35.1岁)高于男性平均年龄(29.9岁)
                </p>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">年龄箱线图</h3>
                <div class="chart-wrapper">
                    <canvas id="ageBoxPlot"></canvas>
                </div>
                <p style="text-align: center; margin-top: 15px; color: #666; font-size: 14px;">
                    显示年龄分布的五数概括：最小值、第一四分位数、中位数、第三四分位数、最大值
                </p>
            </div>
        </div>

        <footer>
            <p>生成时间: <span id="currentDate"></span> | 数据来源: user-data.csv | 可视化工具: Chart.js</p>
            <p>交互提示: 将鼠标悬停在图表元素上可查看详细数据</p>
        </footer>
    </div>

    <script>
        // 设置当前日期
        document.getElementById('currentDate').textContent = new Date().toLocaleString('zh-CN');
        
        // 用户数据
        const userData = [
            {序号:1, 姓名:'ama', 年龄:22, 性别:'女'},
            {序号:2, 姓名:'jame', 年龄:21, 性别:'男'},
            {序号:3, 姓名:'jelly', 年龄:43, 性别:'女'},
            {序号:4, 姓名:'tom', 年龄:33, 性别:'男'},
            {序号:5, 姓名:'liming', 年龄:23, 性别:'男'},
            {序号:6, 姓名:'lihua', 年龄:26, 性别:'男'},
            {序号:7, 姓名:'hoston', 年龄:26, 性别:'男'},
            {序号:8, 姓名:'kallr', 年龄:29, 性别:'男'},
            {序号:9, 姓名:'zec', 年龄:30, 性别:'女'},
            {序号:10, 姓名:'eze', 年龄:43, 性别:'男'},
            {序号:11, 姓名:'may', 年龄:44, 性别:'女'},
            {序号:12, 姓名:'meme', 年龄:23, 性别:'女'},
            {序号:13, 姓名:'xzi', 年龄:12, 性别:'男'},
            {序号:14, 姓名:'will', 年龄:34, 性别:'男'},
            {序号:15, 姓名:'wilb', 年龄:35, 性别:'男'},
            {序号:16, 姓名:'zoo', 年龄:46, 性别:'女'},
            {序号:17, 姓名:'paul', 年龄:46, 性别:'男'},
            {序号:18, 姓名:'relll', 年龄:57, 性别:'女'},
            {序号:19, 姓名:'ray', 年龄:23, 性别:'男'},
            {序号:20, 姓名:'desin', 年龄:24, 性别:'女'}
        ];

        // 提取年龄数据
        const ages = userData.map(user => user.年龄);
        
        // 计算年龄分布直方图数据
        const ageBins = [10, 20, 30, 40, 50, 60];
        const ageLabels = ['10-19', '20-29', '30-39', '40-49', '50-59'];
        const ageCounts = new Array(ageLabels.length).fill(0);
        
        ages.forEach(age => {
            if (age >= 10 && age < 20) ageCounts[0]++;
            else if (age < 30) ageCounts[1]++;
            else if (age < 40) ageCounts[2]++;
            else if (age < 50) ageCounts[3]++;
            else if (age <= 60) ageCounts[4]++;
        });

        // 1. 年龄分布直方图
        const ageHistogramCtx = document.getElementById('ageHistogram').getContext('2d');
        new Chart(ageHistogramCtx, {
            type: 'bar',
            data: {
                labels: ageLabels,
                datasets: [{
                    label: '用户数量',
                    data: ageCounts,
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.7)',
                        'rgba(75, 192, 192, 0.7)',
                        'rgba(255, 206, 86, 0.7)',
                        'rgba(255, 99, 132, 0.7)',
                        'rgba(153, 102, 255, 0.7)'
                    ],
                    borderColor: [
                        'rgba(54, 162, 235, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(255, 99, 132, 1)',
                        'rgba(153, 102, 255, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `用户数量: ${context.raw} 人`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: '用户数量'
                        },
                        ticks: {
                            stepSize: 1
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: '年龄区间'
                        }
                    }
                }
            }
        });

        // 2. 性别比例饼图
        const genderCounts = {
            '男': userData.filter(user => user.性别 === '男').length,
            '女': userData.filter(user => user.性别 === '女').length
        };

        const genderPieCtx = document.getElementById('genderPieChart').getContext('2d');
        new Chart(genderPieCtx, {
            type: 'pie',
            data: {
                labels: ['男性', '女性'],
                datasets: [{
                    data: [genderCounts['男'], genderCounts['女']],
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.7)',
                        'rgba(255, 99, 132, 0.7)'
                    ],
                    borderColor: [
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 99, 132, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                const percentage = Math.round((value / userData.length) * 100);
                                return `${label}: ${value} 人 (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });

        // 3. 按性别分组的年龄分布（分组柱状图）
        const maleAges = userData.filter(user => user.性别 === '男').map(user => user.年龄);
        const femaleAges = userData.filter(user => user.性别 === '女').map(user => user.年龄);
        
        // 计算统计量
        function calculateStats(ages) {
            if (ages.length === 0) return { min: 0, max: 0, avg: 0, median: 0 };
            
            const sorted = [...ages].sort((a, b) => a - b);
            const min = Math.min(...ages);
            const max = Math.max(...ages);
            const avg = ages.reduce((sum, age) => sum + age, 0) / ages.length;
            const median = sorted.length % 2 === 0 
                ? (sorted[sorted.length/2 - 1] + sorted[sorted.length/2]) / 2
                : sorted[Math.floor(sorted.length/2)];
            
            return { min, max, avg: Math.round(avg * 10) / 10, median };
        }
        
        const maleStats = calculateStats(maleAges);
        const femaleStats = calculateStats(femaleAges);

        const ageByGenderCtx = document.getElementById('ageByGenderChart').getContext('2d');
        new Chart(ageByGenderCtx, {
            type: 'bar',
            data: {
                labels: ['男性', '女性'],
                datasets: [
                    {
                        label: '平均年龄',
                        data: [maleStats.avg, femaleStats.avg],
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    },
                    {
                        label: '中位数年龄',
                        data: [maleStats.median, femaleStats.median],
                        backgroundColor: 'rgba(255, 159, 64, 0.7)',
                        borderColor: 'rgba(255, 159, 64, 1)',
                        borderWidth: 1
                    },
                    {
                        label: '最小年龄',
                        data: [maleStats.min, femaleStats.min],
                        backgroundColor: 'rgba(75, 192, 192, 0.7)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    },
                    {
                        label: '最大年龄',
                        data: [maleStats.max, femaleStats.max],
                        backgroundColor: 'rgba(255, 99, 132, 0.7)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: ${context.raw} 岁`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: '年龄'
                        }
                    }
                }
            }
        });

        // 4. 年龄箱线图（使用箱线图插件）
        // 首先需要计算五数概括
        function calculateBoxPlotData(ages) {
            if (ages.length === 0) return { min: 0, q1: 0, median: 0, q3: 0, max: 0 };
            
            const sorted = [...ages].sort((a, b) => a - b);
            const min = Math.min(...ages);
            const max = Math.max(...ages);
            
            // 计算四分位数
            const medianIndex = Math.floor(sorted.length / 2);
            const median = sorted.length % 2 === 0 
                ? (sorted[medianIndex - 1] + sorted[medianIndex]) / 2
                : sorted[medianIndex];
            
            const lowerHalf = sorted.slice(0, medianIndex);
            const upperHalf = sorted.slice(sorted.length % 2 === 0 ? medianIndex : medianIndex + 1);
            
            const q1 = lowerHalf.length % 2 === 0
                ? (lowerHalf[Math.floor(lowerHalf.length / 2) - 1] + lowerHalf[Math.floor(lowerHalf.length / 2)]) / 2
                : lowerHalf[Math.floor(lowerHalf.length / 2)];
                
            const q3 = upperHalf.length % 2 === 0
                ? (upperHalf[Math.floor(upperHalf.length / 2) - 1] + upperHalf[Math.floor(upperHalf.length / 2)]) / 2
                : upperHalf[Math.floor(upperHalf.length / 2)];
            
            return { min, q1, median, q3, max };
        }
        
        const boxPlotData = calculateBoxPlotData(ages);
        
        // 由于Chart.js原生不支持箱线图，我们使用条形图模拟箱线图
        const ageBoxPlotCtx = document.getElementById('ageBoxPlot').getContext('2d');
        new Chart(ageBoxPlotCtx, {
            type: 'bar',
            data: {
                labels: ['年龄分布'],
                datasets: [
                    {
                        label: '最小值',
                        data: [boxPlotData.min],
                        backgroundColor: 'rgba(75, 192, 192, 0.7)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    },
                    {
                        label: '第一四分位数(Q1)',
                        data: [boxPlotData.q1 - boxPlotData.min],
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    },
                    {
                        label: '中位数',
                        data: [boxPlotData.median - boxPlotData.q1],
                        backgroundColor: 'rgba(255, 206, 86, 0.7)',
                        borderColor: 'rgba(255, 206, 86, 1)',
                        borderWidth: 1
                    },
                    {
                        label: '第三四分位数(Q3)',
                        data: [boxPlotData.q3 - boxPlotData.median],
                        backgroundColor: 'rgba(153, 102, 255, 0.7)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    },
                    {
                        label: '最大值',
                        data: [boxPlotData.max - boxPlotData.q3],
                        backgroundColor: 'rgba(255, 99, 132, 0.7)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: '年龄'
                        }
                    },
                    y: {
                        stacked: true
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const datasetLabel = context.dataset.label;
                                let value;
                                switch(datasetLabel) {
                                    case '最小值':
                                        value = boxPlotData.min;
                                        break;
                                    case '第一四分位数(Q1)':
                                        value = boxPlotData.q1;
                                        break;
                                    case '中位数':
                                        value = boxPlotData.median;
                                        break;
                                    case '第三四分位数(Q3)':
                                        value = boxPlotData.q3;
                                        break;
                                    case '最大值':
                                        value = boxPlotData.max;
                                        break;
                                    default:
                                        value = context.raw;
                                }
                                return `${datasetLabel}: ${value} 岁`;
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>